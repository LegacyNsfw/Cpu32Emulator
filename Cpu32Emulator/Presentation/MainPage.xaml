<Page x:Class="Cpu32Emulator.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Cpu32Emulator.Presentation"
      NavigationCacheMode="Required">

  <!-- Phase 4: Resources section cleaned up - converters no longer needed -->
  <Page.Resources>
  </Page.Resources>

  <Page.DataContext>
    <local:MainViewModel />
  </Page.DataContext>

  <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Title Bar with Hamburger Button -->
    <Grid Grid.Row="0" 
          Background="{ThemeResource SystemControlBackgroundAltHighBrush}">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      
      <!-- Hamburger Menu Button -->
      <Button x:Name="HamburgerButton"
              Grid.Column="0"
              Style="{StaticResource NavigationBackButtonNormalStyle}"
              Content="&#xE700;"
              FontFamily="Segoe MDL2 Assets"
              FontSize="16"
              Margin="10,5"
              Click="HamburgerButton_Click" />
      
      <!-- Title -->
      <TextBlock Grid.Column="1"
                 Text="CPU32 Emulator"
                 FontSize="24"
                 FontWeight="Bold"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Margin="0,10" />
    </Grid>

    <!-- Main Content with SplitView -->
    <SplitView x:Name="MainSplitView"
               Grid.Row="1"
               DisplayMode="Overlay"
               IsPaneOpen="False"
               OpenPaneLength="250">
      
      <!-- SplitView Pane (Left Menu) -->
      <SplitView.Pane>
        <Grid Background="{ThemeResource SystemControlBackgroundAltHighBrush}">
          <ScrollViewer>
            <StackPanel Margin="0,20,0,0">
              
              <!-- File Section -->
              <TextBlock Text="File"
                        FontWeight="Bold"
                        FontSize="16"
                        Margin="20,0,20,10"
                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
              
              <!-- Project Operations -->
              <Button Content="New Project"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding NewProjectCommand}" />
              
              <Button Content="Load Project"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding LoadProjectCommand}" />
              
              <Button Content="Save Project"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding SaveProjectCommand}" />
              
              <Button Content="Save Project As..."
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding SaveProjectAsCommand}" />
              
              <!-- Separator -->
              <Border Height="1"
                      Background="{ThemeResource SystemControlForegroundBaseLowBrush}"
                      Margin="20,15" />
              
              <!-- ROM Operations -->
              <Button Content="Load ROM"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding LoadRomCommand}" />
              
              <Button Content="Reload ROM"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding ReloadRomCommand}" />
              
              <!-- RAM Operations -->
              <Button Content="Load RAM"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding LoadRamCommand}" />
              
              <Button Content="Reload RAM"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding ReloadRamCommand}" />
              
              <!-- LST Operations -->
              <Button Content="Load .LST"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding LoadLstCommand}" />
              
              <Button Content="Reload .LST"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding ReloadLstCommand}" />
              
              <!-- Separator -->
              <Border Height="1"
                      Background="{ThemeResource SystemControlForegroundBaseLowBrush}"
                      Margin="20,15" />
              
              <!-- Settings Section -->
              <TextBlock Text="Settings"
                        FontWeight="Bold"
                        FontSize="16"
                        Margin="20,10,20,10"
                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
              
              <Button Content="Application Settings"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Left"
                      Margin="10,5"
                      Padding="15,10"
                      Style="{StaticResource ButtonRevealStyle}"
                      Command="{Binding SettingsCommand}" />
              
            </StackPanel>
          </ScrollViewer>
        </Grid>
      </SplitView.Pane>
      
      <!-- SplitView Content (Main Application) -->
      <SplitView.Content>
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          
          <!-- Phase 7: Execution Control Toolbar -->
          <Border Grid.Row="0" 
                  Background="{ThemeResource SystemControlBackgroundAltMediumBrush}"
                  BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
                  BorderThickness="0,0,0,1"
                  Padding="10,8">
            <StackPanel Orientation="Horizontal" Spacing="10">
              <Button Content="▶ Run (F5)"
                      Command="{Binding RunCommand}"
                      Background="{ThemeResource SystemAccentColor}"
                      Padding="12,6"
                      MinWidth="100" />
              
              <Button Content="⏸ Step Into (F11)"
                      Command="{Binding StepIntoCommand}" 
                      Padding="12,6"
                      MinWidth="120" />
              
              <Button Content="⏭ Step Over (F10)"
                      Command="{Binding StepOverCommand}"
                      Padding="12,6"
                      MinWidth="120" />
              
              <Button Content="🔴 Breakpoint (F9)"
                      Command="{Binding ToggleBreakpointCommand}"
                      Padding="12,6"
                      MinWidth="130" />
              
              <Rectangle Width="1" 
                         Fill="{ThemeResource SystemControlForegroundBaseLowBrush}"
                         Margin="5,0" />
              
              <TextBlock Text="{Binding StatusMessage}"
                         VerticalAlignment="Center" />
            </StackPanel>
          </Border>
          
          <!-- Main Content -->
          <Grid Grid.Row="1" Margin="20">
            <!-- Content Grid Layout -->
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
              </Grid.RowDefinitions>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>

        <!-- Top Row: Disassembly (spans both columns) -->
        <Grid Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,10">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          
          <TextBlock Grid.Row="0" 
                     Text="Disassembly" 
                     FontWeight="Bold" 
                     FontSize="16"
                     Margin="0,0,0,5" />
          
          <Border Grid.Row="1"
                  BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
                  BorderThickness="1">
            
            <!-- Phase 4: Tile-Based Disassembly View is now the only implementation -->
            <local:TiledDisassemblyView x:Name="DisassemblyTileView"
                                       ItemsSource="{Binding DisassemblyLines}"
                                       CurrentAddress="{Binding CurrentPCAddress}" />
            
          </Border>
        </Grid>

        <!-- Bottom Left: Registers -->
        <Grid Grid.Row="1" Grid.Column="0" Margin="0,10,5,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          
          <TextBlock Grid.Row="0" 
                     Text="Registers" 
                     FontWeight="Bold" 
                     FontSize="16"
                     Margin="0,0,0,5" />
          
          <Border Grid.Row="1"
                  BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
                  BorderThickness="1">
            <ScrollViewer>
              <!-- Phase 4: Data-bound register grid -->
              <ListView ItemsSource="{Binding Registers}"
                        SelectionMode="None"
                        IsItemClickEnabled="True"
                        ItemClick="RegisterList_ItemClick">
                <ListView.ItemTemplate>
                  <DataTemplate>
                    <Grid Margin="5,2" MinWidth="200">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>
                      
                      <TextBlock Grid.Column="0"
                                 Text="{Binding Name}"
                                 FontFamily="Consolas, Courier New"
                                 FontSize="12"
                                 VerticalAlignment="Center"
                                 FontWeight="SemiBold"
                                 Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                      
                      <TextBlock Grid.Column="1"
                                 Text="{Binding Value}"
                                 FontFamily="Consolas, Courier New"
                                 FontSize="12"
                                 VerticalAlignment="Center"
                                 Margin="10,0,0,0" />
                    </Grid>
                  </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                  <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="2" />
                    <Setter Property="MinHeight" Value="10" />
                  </Style>
                </ListView.ItemContainerStyle>
              </ListView>
            </ScrollViewer>
          </Border>
        </Grid>

        <!-- Bottom Right: Memory -->
        <Grid Grid.Row="1" Grid.Column="1" Margin="5,10,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>
          
          <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
            <TextBlock Text="Memory Watch" 
                       FontWeight="Bold" 
                       FontSize="16"
                       VerticalAlignment="Center"
                       Margin="0,0,10,0" />
            <Button Content="Add" 
                    Command="{Binding AddMemoryWatchCommand}"
                    Margin="0,0,5,0" />
          </StackPanel>
          
          <Border Grid.Row="1"
                  BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
                  BorderThickness="1">
            <ScrollViewer>
              <ListView ItemsSource="{Binding MemoryWatches}"
                        SelectionMode="Single">
                <ListView.HeaderTemplate>
                  <DataTemplate>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="80" />
                      </Grid.ColumnDefinitions>
                      <TextBlock Grid.Column="0" Text="Address" FontWeight="Bold" />
                      <TextBlock Grid.Column="1" Text="Value" FontWeight="Bold" />
                      <TextBlock Grid.Column="2" Text="Width" FontWeight="Bold" />
                      <TextBlock Grid.Column="3" Text="Actions" FontWeight="Bold" />
                    </Grid>
                  </DataTemplate>
                </ListView.HeaderTemplate>
                <ListView.ItemTemplate>
                  <DataTemplate>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="80" />
                      </Grid.ColumnDefinitions>
                      
                      <TextBlock Grid.Column="0" 
                                 Text="{Binding Address}"
                                 FontFamily="Consolas"
                                 VerticalAlignment="Center"
                                 Tapped="OnMemoryAddressTapped" />

                      <TextBlock Grid.Column="1" 
                                 Text="{Binding Value}"
                                 FontFamily="Consolas"
                                 VerticalAlignment="Center"
                                 Tapped="OnMemoryValueTapped" />

                      <TextBlock Grid.Column="2" 
                                 Text="{Binding Width}"
                                 FontFamily="Consolas"
                                 VerticalAlignment="Center"
                                 Tapped="OnMemoryWidthTapped" />

                      <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <Button Content="×" 
                                Click="OnRemoveMemoryWatch"
                                FontSize="12" 
                                Width="20" 
                                Height="20"
                                ToolTipService.ToolTip="Remove memory watch" />
                      </StackPanel>
                    </Grid>
                  </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                  <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="Padding" Value="5,2" />
                    <Setter Property="MinHeight" Value="20" />
                  </Style>
                </ListView.ItemContainerStyle>
              </ListView>
            </ScrollViewer>
          </Border>
        </Grid>
            </Grid>
          </Grid>
        </Grid>
      </SplitView.Content>
    </SplitView>

    <!-- Status Bar -->
    <Border Grid.Row="2" 
            Background="{ThemeResource SystemControlBackgroundAltMediumBrush}"
            BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
            BorderThickness="0,1,0,0"
            Padding="20,5">
      <TextBlock Text="{Binding StatusMessage}" />
    </Border>
  </Grid>
</Page>
